---
timestamp: 'Wed Oct 29 2025 18:33:11 GMT-0400 (Eastern Daylight Time)'
parent: '[[..\20251029_183311.56c0e6c6.md]]'
content_id: adb65cd782027622c44554154c66737908aaeb764d4c5847ec1e0ddd7774e0e0
---

# TripCostEstimation

## Purpose

Generate realistic cost estimates based on trip details, using AI for data retrieval and calculation.

## Principle

Based on a user's choice of initial departure city and arrival city, and the user's sheltering accommodations and food location preferences, an estimate is provided; the LLM is used to search for and calculate median cost ranges based on the provided necessities.

## State

* A set of `Users` with
  * A set of `TravelPlans`
  * A set of `CostEstimates`
* A set of `TravelPlans` with
  * A `fromCity` Location
  * A `toCity` Location
  * A `fromDate` Date
  * A `toDate` Date
  * A `necessity` Necessity
  * A LatestUpdatedCostEstimate CostEstimate
* A set of `Necessities` with
  * An `accommodation` Boolean // true for saving for rooms, false for not
  * A `diningFlag` Boolean // true for saving for eating out, false for not
* A set of `CostEstimates` with
  * A `travelPlanID` String
  * A `flight` Number // estimated total round-trip flight cost in USD
  * A `roomsPerNight` Number // estimated cost per night in USD
  * A `foodDaily` Number // estimated cost per day in USD
  * A `lastUpdated` Date // tracking when the estimate was generated

## Actions

* `createTravelPlan(user: User, fromCity: Location, toCity: Location, fromDate: Date, toDate: Date): (travelPlan: TravelPlan)`
  * **Requires:** `toDate` >= `fromDate` and both are greater than the current date
  * **Effect:** Create and return a `travelPlan` with a `fromCity`, `toCity`, and from and to dates, and a default necessity (`accommodation` = true, `diningFlag` = true); If a `travelPlan` exists with the same values as the input parameters, then return that `travelPlan`

* `deleteTravelPlan(user: User, travelPlan: TravelPlan): (travelPlan: TravelPlan)`
  * **Requires:** `travelPlan` exists and belongs to user
  * **Effect:** Delete the `travelPlan` and any associated `CostEstimates`

* `updateNecessity(user: User, travelPlan: TravelPlan, accommodation: Boolean, diningFlag: Boolean): (travelPlan: TravelPlan, necessity: Necessity)`
  * **Requires:** `travelPlan` exists and belongs to user, `accommodation` exists as one of the livingSpaces and `diningFlag` indicates whether the user plans to save for eating out (true) or not (false)
  * **Effect:** Create and add the `necessity` with `accommodation` and `diningFlag` to `travelPlan`

* `resetNecessity(user: User, travelPlan: TravelPlan): (necessity: Necessity)`
  * **Requires:** `travelPlan` exists and belongs to user
  * **Effect:** Reset the `necessity` belonging to `travelPlan` to the default as described in the action `createTravelPlan`

* **async** `generateAICostEstimate(user: User, travelPlan: TravelPlan, llm: GeminiLLM): (costEstimate: CostEstimate)`
  * **Requires:** `travelPlan` exists and belongs to user
  * **Effect:** Retrieves trip details (dates, locations) and necessity preference (accommodation, dining) and uses the llm's specialized tool (e.g., Google Search/Flights/Hotels) to calculate and return the median cost estimates for flight, `rooms_per_night`, and `food_daily`; the resulting data is stored as a new `CostEstimate` associated with the `travelPlanID`. Also, add the most recent CostEstimate to `travelPlan`
  * **Note:** The LLM prompt will be specifically tailored to search for accommodation prices matching the `accommodation` Boolean (e.g., true for hotel/motel costs) and food costs based on the `diningFlag` (true for "restaurant costs," false for "no food costs"). If the LLM fails to provide an estimate for any reason or the costs are widely inaccurate (less than 50, more than 100000 for example) then the user can manually enter the total cost of the trip that they plan to save for.

* `editEstimateCost(user: User, travelPlan: TravelPlan, flight: Number, roomsPerNight: Number, foodDaily: Number): (costEstimate: CostEstimate)`
  * **Requires:** `travelPlan` exists and belongs to user. `flight`, `roomsPerNight`, and `foodDaily` are non-negative numbers.
  * **Effect:** Creates or updates the `CostEstimate` for the given `travelPlan` with the manually provided values. The `lastUpdated` timestamp is set to the current date. This new estimate becomes the `LatestUpdatedCostEstimate` for the `travelPlan`.

* `deleteEstimateCost(user: User, costEstimate: CostEstimate): (costEstimate: CostEstimate)`
  * **Requires:** `costEstimate` exists and belongs to user
  * **Effect:** Deletes the `CostEstimate` (and returns it) associated with the user and sets the `travelPlan`'s `LatestUpdatedCostEstimate` to the second most recently updated cost estimate, if there is none sets this to null.

* `estimateCost (user: User, travelPlan: TravelPlan): (totalCost: Number)`
  * **Requires:** `travelPlan` exists and belongs to user and an associated `CostEstimate` exists
  * **Effect:** Calculates and returns the `totalCost` by multiplying the estimated daily/nightly costs by the duration and adding the flight cost.

* `getTravelDetails(user: User, travelPlan: TravelPlan): (fromCity: Location, toCity: Location, fromDate: Date, toDate: Date, necessity: Necessity)`
  * **Requires:** `travelPlan` exists and belongs to the `user`.
  * **Effect:** Returns the `fromCity`, `toCity`, `fromDate`, `toDate`, and `necessity` associated with the specified `travelPlan`.

* `_getAllTravelPlans(user: User): (travelPlans: TravelPlan[])`
  * **Requires:** `user` exists
  * **Effect:** Returns a list of all `TravelPlans` associated with the given `user`.

## Notes

The LLM augmentation moves the burden of research and calculation from the user to the LLM. The original `estimateCost` action is now strictly a calculation of the stored AI-generated or manually-inputted estimate. A manual fallback for cost input will still be available in the final implementation.
